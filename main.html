<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>Main Node</title>
    <link rel="shortcut icon" href="led.svg">
    <link rel="stylesheet" href="popup.css">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            margin: 0;
            background-image: url('wallpaper.jpg');
            background-repeat: no-repeat;
            background-size: cover;
        }
        .container {
            width: 960px;
            margin: 0 auto;
            padding: 0px;
            position: relative;
        }
    </style>
    <script defer src="drag.js"></script>
</head>
<body>
    <div class="" id="mydiv" style="position: absolute; top: 40px; left: 60px; background-color: white; width: 400px; height: 450px; border: solid;">
        <div id="mydivheader" style="background-color: blue; padding-left: 0; height: 8%;"></div> 
        <div id="mydivcontent" style="width: 100%; height: 100%; padding-left: 1vw; padding-bottom: 10px;">
            <object id="led" style="margin-left: 80px; width: 50%;" type="image/svg+xml" data="led.svg"></object>
            <h1 style="font-size: 50px;">Led Morse</h1>
            <input id="morse" style="float: left; padding-left: 15px; font-size: 20px; width: 270px; height: 50px" pattern="[a-y]{1,32}" minlength="1" maxlength="32" required> 
            <button class="popup" id="but" style="float: left; background-color: green; width: 45px; height: 50px; margin: 2.5px 0 0 10px; border-radius: 10px;"></button>
            <div class="popup"><span class="popuptext" id="myPopup">Wait your turn...</span></div>
        </div>
    </div>
    <script type="module">
        import { io } from "https://cdn.socket.io/4.4.1/socket.io.esm.min.js";
        const socket = io();
        document.getElementById("but").addEventListener("click", function() {
            socket.emit('morse', document.getElementById("morse").value);
        }); var doc = document.getElementById("led").getSVGDocument();
        socket.on('connect', () => {
            console.log(`Client Connected: ${socket.id}`);
            socket.on('on', (state) => {
                doc.getElementById("lamp1").setAttribute("style", "fill: red; filter: drop-shadow(0 0 2rem red);");
                doc.getElementById("lamp2").setAttribute("style", "fill: red; filter: drop-shadow(0 0 2rem red);");
                document.getElementById("but").style.backgroundColor = "crimson";
            });
            socket.on('off', (state) => {
                doc.getElementById("lamp1").setAttribute("style", "fill: red; filter: brightness(50%);");
                doc.getElementById("lamp2").setAttribute("style", "fill: red; filter: brightness(50%);");
                document.getElementById("but").style.backgroundColor = "green";
                document.getElementById("myPopup").classList.remove("show");
            });
            socket.on('wait', (state) => {
                document.getElementById("myPopup").classList.add("show");
            });
        });
    </script>
</body>